---
title: "Lab 07 - Modelling course evaluations"
author: "Carla Martin"
date: "`r Sys.Date()`"
output: html_document
---

### Packages and Data

```{r load-packages, message=FALSE, echo=TRUE}
library(tidyverse)
library(tidymodels)

```


```{r read-data}
evals<-read.csv("data/evals.csv", row.names=1)
```


# Exercise 1: Exploratory Data Analysis

1.  Visualize the distribution of `score` in the dataframe `evals`.

```{r viz-score}
ggplot(data = evals,
       mapping = aes(x = score)) +
  geom_histogram()

evals %>%
  summarise(avg_score = mean(score),
            med_score = median(score))
```

the distribution is skewed to the right, so the students rate their courses highly. The mean score was 4.2 and the median score was 4.3. I expected the students to enjoy the class so this makes sense to me.

2.  Visualize and describe the relationship between `score` and `bty_avg` using `geom_point()` to represent the data. 

```{r scatterplot}
ggplot(data = evals,
       mapping = aes(x = score, y = bty_avg)) +
  geom_point()

ggplot(data = evals,
       mapping = aes(x = score, y = bty_avg)) +
  geom_jitter()
```

The relationship between bty_avg and score appears to be a very weak one, but does appear to be positive. The jitter revealed more points on the graph that were initially hidden, and showed the correlation was stronger than it previously appeared.

# Exercise 2: Simple Linear regression with a numerical predictor

1. Fit a linear model called `score_bty_fit` to predict average professor evaluation `score` from average beauty rating (`bty_avg`). Print the regression output using `tidy()`.

```{r fit-score_bty_fit}
score_bty_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(score ~ bty_avg, data = evals)
```

```{r tidy-score_bty_fit}
tidy(score_bty_fit)
```

score-hat = 3.88 + 0.0666 x bty_avg

2. Plot the data again using `geom_jitter()`, and add the regression line.

```{r viz-score_bty_fit,eval=FALSE}
ggplot(data = evals,
       mapping = aes(x = score, y = bty_avg)) +
  geom_jitter() +
  geom_smooth(method = lm, se = FALSE)
```

3. Interpret the slope of the linear model in context of the data.

For each additional point a professor is scored, their beauty rating is expected to increase by 0.0666.

4. Interpret the intercept of the linear model in context of the data. Comment on whether or not the intercept makes sense in this context.

The intercept represents the beauty rating of a professor who's overall score is 0. This means a professor with a 0 rating would have a beauty rating of 3.88. I do not think this make sense as if you were to mark a professor that low it would be more to do with the teaching. Mathematically however, this makes sense.

5. Determine the $R^2$ of the model and interpret it in the context of the data.

```{r R2}
glance(score_bty_fit)$r.squared
```

This is quite a low R^2 value, meaning the models predictions are not very accurate. This means the correlation between beauty rating and score is weak, so the model is not very suitable.

6. Make a plot of residuals vs. predicted values for the model above.

```{r viz-score_bty_fit-diagnostic, eval = FALSE}
# remove eval = FALSE from the code chunk options after filling in the blanks
score_bty_aug <- augment(score_bty_fit$fit)

ggplot(score_bty_aug,
       mapping = aes(x = .fitted, y = .resid)) + 
  geom_jitter(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed")
```
There does not seem to be much of a pattern, but there is more dense residuals above the line than below it, so this is somewhat appropriate for modelling the relationship.

# Exercise 3: Simple Linear regression with a categorical predictor

0. Look at the variable rank, and determine the frequency of each category level.

```{r}
 evals %>%
  count(rank)
```

1. Fit a new linear model called `score_rank_fit` to predict average professor evaluation `score` based on `rank` of the professor.

```{r fit-score_rank_fit}
# fit model
score_rank_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(score ~ rank, data = evals)

# tidy model output
tidy(score_rank_fit)
```

the intercept is the estimated ranking for tenure track.
the slope indicated that tenured professors rank on average 0.13 lower than tenure track professors

2. Fit a new linear model called `score_gender_fit` to predict average professor evaluation `score` based on `gender` of the professor. 

```{r fit-score_gender_fit}
# fit model
score_gender_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(score ~ gender, data = evals)

# tidy model output
tidy(score_gender_fit)
```

```{r score_gender_intercept}
score_gender_intercept <- tidy(score_gender_fit) %>% 
  filter(term == "(Intercept)") %>%
  select(estimate) %>%
  pull()
```

```{r score_gender_slope}
score_gender_slope <- tidy(score_gender_fit) %>% 
  filter(term == "gendermale") %>%
  select(estimate) %>%
  pull()
```

the estimated rating for a female is 4.1, and it increases by 0.14 if the professor is male

# Exercise 4: Multiple linear regression

1. Fit a multiple linear regression model, predicting average professor evaluation `score` based on average beauty rating (`bty_avg`) and `gender.`

```{r fit-score_bty_gender_fit}
# fit model

# tidy model output
```

*Add your narrative here.*

```{r eval = FALSE}
ggplot(___) + ...
```

2. What percent of the variability in `score` is explained by the model `score_bty_gender_fit`. 

```{r}
# ...
```


3. What is the equation of the line corresponding to just male professors?

*Add your equation here.*

4. For two professors who received the same beauty rating, which gender tends to have the higher course evaluation score?

*Add your narrative here.*

5. How does the relationship between beauty and evaluation score vary between male and female professors?

*Add your narrative here.*

6. How do the adjusted $R^2$ values of `score_bty_fit` and `score_bty_gender_fit` compare? 

```{r eval=FALSE}
# remove eval = FALSE from the code chunk options after filling in the blanks
glance(___)$adj.r.squared
glance(___)$adj.r.squared
```

*Add your narrative here.*

7. Compare the slopes of `bty_avg` under the two models (`score_bty_fit` and `score_bty_gender_fit`).

*Add your narrative here.*

# Exercise 5: Interpretation of log-transformed response variables

If you do not know how to use LaTeX, do this exercise with pen and paper.
